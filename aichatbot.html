<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta property="og:site_name" content="Motoopen">
  <title>Motoopen AI v3.0 ‚Äî iOS Chat Card</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      margin: 0; background: #f5f5f7; color: #222;
      display: flex; flex-direction: column; min-height: 100vh;
    }
    header, footer {
      text-align: center; padding: 16px;
      background: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    main { flex: 1; padding: 24px; max-width: 800px; margin: auto; }
  </style>
</head>
<body>
  <header>
    <h1>Motoopen</h1>
    <p>Thu√™ Xe M√°y H√† N·ªôi ‚Äì Gi√° R·∫ª, Giao T·∫≠n N∆°i üö≤</p>
  </header>

  <main>
    <p>D·ªãch v·ª• cho thu√™ xe m√°y ch·∫•t l∆∞·ª£ng cao t·∫°i H√† N·ªôi. C√≥ xe s·ªë, xe ga, xe ƒëi·ªán. 
    Giao t·∫≠n n∆°i trong 15 ph√∫t, h·ªó tr·ª£ 24/7.</p>
    <p>Li√™n h·ªá ngay Zalo: 0857 255 868 ho·∫∑c t·ªõi ƒë·ªãa ch·ªâ Long Bi√™n, H√† N·ªôi.</p>
  </main>

  <footer>¬© 2025 Motoopen</footer>

  <!-- Motoopen AI v3.0 ‚Äî iOS Chat Card -->
  <script>
  (function(){
    const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
    const STATE={corpus:[]};
    const embed=t=>{const m=new Map();t=t?.toLowerCase()||'';for(let i=0;i<=t.length-3;i++){const g=t.slice(i,i+3);m.set(g,(m.get(g)||0)+1);}return m;}
    const sim=(a,b)=>{const ks=new Set([...a.keys(),...b.keys()]);let dot=0,na=0,nb=0;for(const k of ks){const va=a.get(k)||0,vb=b.get(k)||0;dot+=va*vb;na+=va*va;nb+=vb*vb;}return dot/(Math.sqrt(na)*Math.sqrt(nb)+1e-12);}
    const retrieve=q=>STATE.corpus.map(s=>({text:s,score:sim(embed(q),embed(s))})).sort((a,b)=>b.score-a.score).slice(0,10);
    const extractCorpus=()=>{STATE.corpus=[...document.body.innerText.split(/\n+/).filter(x=>x.length>30)];};
    const detectSite=()=>document.querySelector('meta[property="og:site_name"]')?.content||document.title||'website n√†y';
    async function generateAnswer(q){
      const cand=retrieve(q);
      if(!cand.length||cand[0].score<0.05) return "M√¨nh ch∆∞a th·∫•y th√¥ng tin n√†y ü§î. B·∫°n th·ª≠ h·ªèi r√µ h∆°n nh√©!";
      return cand.slice(0,2).map(c=>c.text).join(' ');
    }

    function buildUI(){
      const site=detectSite();
      const root=document.createElement('div');
      root.id='motoai-root';
      root.innerHTML=`
      <style>
        #motoai-bubble{
          position:fixed;left:18px;bottom:130px;width:60px;height:60px;border-radius:20px;
          background:#007aff;color:#fff;display:flex;align-items:center;justify-content:center;
          box-shadow:0 6px 20px rgba(0,0,0,0.25);cursor:pointer;z-index:99999;
        }
        #motoai-card{
          position:fixed;left:0;right:0;bottom:0;height:80%;
          border-radius:20px 20px 0 0;background:rgba(255,255,255,0.95);
          backdrop-filter:blur(10px);box-shadow:0 -6px 30px rgba(0,0,0,0.25);
          transform:translateY(110%);opacity:0;transition:transform .4s cubic-bezier(.25,.9,.25,1),opacity .3s ease;
          display:flex;flex-direction:column;overflow:hidden;z-index:99998;
        }
        #motoai-card.open{transform:translateY(0);opacity:1;}
        #motoai-handle{
          width:40px;height:5px;background:#ccc;border-radius:3px;margin:10px auto;
        }
        #motoai-header{padding:6px 14px;font-weight:700;color:#007aff;text-align:center;}
        #motoai-body{flex:1;overflow:auto;padding:10px 14px;}
        #motoai-input{display:flex;gap:8px;padding:10px;border-top:1px solid #ddd;background:rgba(255,255,255,0.8);}
        #motoai-input input{flex:1;padding:10px;border-radius:10px;border:1px solid #ccc;}
        #motoai-input button{padding:10px 16px;background:#007aff;color:#fff;border:none;border-radius:10px;cursor:pointer;}
        .m-msg{margin:6px 0;padding:8px 12px;border-radius:10px;max-width:85%;}
        .m-msg.user{margin-left:auto;background:#007aff;color:#fff;}
        .m-msg.bot{margin-right:auto;background:rgba(240,240,240,0.9);}
      </style>
      <div id="motoai-bubble"><svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M21 15a2 2 0 0 1-2 2H8l-5 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10z" fill="currentColor"/></svg></div>
      <div id="motoai-card">
        <div id="motoai-handle"></div>
        <div id="motoai-header">${site} AI</div>
        <div id="motoai-body"></div>
        <div id="motoai-input">
          <input id="motoai-input-el" placeholder="Nh·∫≠p c√¢u h·ªèi..."/>
          <button id="motoai-send">G·ª≠i</button>
        </div>
      </div>`;
      document.body.appendChild(root);

      const bubble=root.querySelector('#motoai-bubble');
      const card=root.querySelector('#motoai-card');
      const input=card.querySelector('#motoai-input-el');
      const send=card.querySelector('#motoai-send');
      const body=card.querySelector('#motoai-body');
      const handle=card.querySelector('#motoai-handle');

      const addMsg=(role,text)=>{
        const d=document.createElement('div');
        d.className='m-msg '+(role==='user'?'user':'bot');
        d.textContent=text;
        body.appendChild(d);
        body.scrollTop=body.scrollHeight;
      };

      async function ask(q){
        if(!q.trim())return;
        addMsg('user',q);
        input.value='';
        const thinking=document.createElement('div');
        thinking.className='m-msg bot';
        thinking.textContent='ƒêang g√µ‚Ä¶';
        body.appendChild(thinking);
        try{const ans=await generateAnswer(q);thinking.remove();addMsg('bot',ans);}
        catch{thinking.textContent='L·ªói x·ª≠ l√Ω üòÖ';}
      }

      send.addEventListener('click',()=>ask(input.value));
      input.addEventListener('keydown',e=>{if(e.key==='Enter')ask(input.value);});

      bubble.addEventListener('click',()=>{
        card.classList.add('open');
        bubble.style.opacity='0'; bubble.style.pointerEvents='none';
        setTimeout(()=>input.focus(),400);
      });

      handle.addEventListener('click',()=>{
        card.classList.remove('open');
        bubble.style.opacity='1'; bubble.style.pointerEvents='auto';
      });

      // Greet
      addMsg('bot',`Xin ch√†o üëã! M√¨nh l√† ${site} AI ‚Äî tr·ª£ l√Ω ·∫£o c·ªßa trang n√†y. H·ªèi m√¨nh v·ªÅ gi√° thu√™, lo·∫°i xe, giao xe nh√©!`);
    }

    extractCorpus(); buildUI();
  })();
  </script>
</body>
</html>
