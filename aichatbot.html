<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover" />
  <meta property="og:site_name" content="Motoopen">
  <title>Motoopen AI v3.2 ‚Äî iOS Chat Card</title>
  <style>
    :root{
      --accent:#007aff;
      --card-bg: rgba(255,255,255,0.96);
      --card-bg-dark: rgba(20,20,22,0.92);
      --text: #111;
    }
    @media (prefers-color-scheme: dark){
      :root{ --card-bg: var(--card-bg-dark); --text: #eee; }
      body{ background: #081018; color: #ddd; }
    }

    html,body{height:100%;margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial;}
    body{ background:#f5f7fb; color:var(--text); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }
    header,footer{padding:14px;text-align:center;background:#fff;box-shadow:0 2px 8px rgba(0,0,0,0.04);}
    main{max-width:900px;margin:28px auto;padding:18px;background:#fff;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.04);}

    /* ===== Motoopen AI styles ===== */
    #motoai-root { position: fixed; left: 18px; bottom: 190px; z-index: 2147483000; pointer-events: none; }

    #motoai-bubble {
      pointer-events: auto;
      width:58px; height:58px; border-radius:14px;
      display:flex; align-items:center; justify-content:center;
      font-size:28px; line-height:1;
      background:var(--accent); color:#fff;
      box-shadow:0 10px 28px rgba(0,0,0,0.24);
      cursor:pointer; -webkit-tap-highlight-color: transparent;
      transition: transform .18s ease, opacity .22s ease;
      -webkit-user-select:none; user-select:none;
    }
    #motoai-bubble.hidden { opacity: 0; transform: scale(.88); pointer-events: none; }

    #motoai-backdrop {
      position: fixed; inset:0; background: rgba(0,0,0,0.18);
      backdrop-filter: blur(6px); opacity:0; pointer-events:none; transition: opacity .28s ease; z-index:2147482999;
    }
    #motoai-backdrop.show { opacity:1; pointer-events:auto; }

    #motoai-card {
      position: fixed;
      left: 0; right: 0; bottom: 0;
      height: 80vh; max-height: 820px;
      margin: 0 auto;
      width: min(920px, calc(100% - 28px));
      border-radius: 18px 18px 0 0;
      background: var(--card-bg);
      box-shadow: 0 -12px 40px rgba(10,20,30,0.18);
      transform: translateY(110%); opacity: 0;
      transition: transform .42s cubic-bezier(.2,.9,.2,1), opacity .28s ease;
      display:flex; flex-direction:column; overflow:hidden; z-index:2147483000;
      pointer-events: auto;
      -webkit-overflow-scrolling: touch;
    }
    #motoai-card.open { transform: translateY(0); opacity:1; }

    #motoai-handle { width:54px;height:6px;background:#d0d6dc;border-radius:6px;margin:10px auto; cursor:grab; }
    #motoai-header { padding:6px 14px; font-weight:700; color:var(--accent); text-align:center; user-select:none; }
    #motoai-body { flex:1; overflow:auto; padding:12px 14px; font-size:15px; -webkit-overflow-scrolling:touch; }

    /* messages */
    .m-msg { margin:8px 0; padding:10px 12px; border-radius:12px; max-width:84%; line-height:1.35; word-wrap:break-word; }
    .m-msg.bot { background: rgba(240,240,246,0.95); color: var(--text); margin-right:auto; }
    .m-msg.user { background: linear-gradient(180deg,var(--accent), #00b6ff); color: #fff; margin-left:auto; }
    .typing { background: rgba(230,230,240,0.8); color:#555; font-style:italic; }

    /* === Dark Mode Fix + Input polish === */
    @media (prefers-color-scheme: dark) {
      .m-msg.bot { background: rgba(40,40,50,0.9); color: #f2f2f2; }
      .m-msg.user { background: linear-gradient(180deg, #0a84ff, #007aff); color: #fff; }
      .typing { background: rgba(50,50,60,0.9); color: #aaa; }
      #motoai-input {
        background: linear-gradient(180deg, rgba(25,25,30,0.6), rgba(25,25,30,0.9));
        border-top: 1px solid rgba(255,255,255,0.08);
      }
      #motoai-input input {
        background: rgba(255,255,255,0.08);
        color: #fff;
        border: 1px solid rgba(255,255,255,0.15);
        caret-color: #00b6ff;
      }
      #motoai-input input::placeholder { color: rgba(255,255,255,0.5); }
      #motoai-input input:focus {
        border-color: #0a84ff;
        background: rgba(255,255,255,0.12);
        outline: none;
      }
      #motoai-input button {
        background: linear-gradient(180deg, #0a84ff, #007aff);
        color: #fff;
      }
    }

    /* input row */
    #motoai-input { display:flex; gap:8px; padding:10px; border-top:1px solid rgba(0,0,0,0.06); background: linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.8)); }
    #motoai-input input { flex:1; padding:12px;border-radius:12px;border:1px solid #d6dde6; font-size:16px; outline:none; background:transparent; color:inherit; }
    #motoai-input button { padding:10px 14px; border-radius:10px; border:none; background:var(--accent); color:#fff; font-weight:700; cursor:pointer; }

    input, textarea, select, button { font-size:16px; }

    @media(max-width:420px){
      #motoai-root { left: 12px; bottom: 180px; }
      #motoai-card { width: calc(100% - 20px); left:10px; right:10px; border-radius: 12px 12px 0 0; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Motoopen</h1>
    <p>Thu√™ Xe M√°y H√† N·ªôi ‚Äî Gi√° R·∫ª, Giao T·∫≠n N∆°i</p>
  </header>

  <main>
    <h2>Demo n·ªôi dung trang</h2>
    <p>ƒê√¢y l√† trang demo ƒë·ªÉ test Motoopen AI mini-app. N·ªôi dung trang s·∫Ω ƒë∆∞·ª£c c√†o ƒë·ªÉ t·∫°o ch·ªâ m·ª•c tr·∫£ l·ªùi.</p>
    <p>Li√™n h·ªá: Zalo 0857 255 868 ‚Äî Giao t·∫≠n n∆°i t·∫°i H√† N·ªôi.</p>
    <p>Th√¥ng tin th√™m: Thu√™ xe theo ng√†y, tu·∫ßn, th√°ng. C·ªçc nh·∫π, b·∫£o d∆∞·ª°ng ƒë·ªãnh k·ª≥.</p>
  </main>

  <footer>¬© 2025 Motoopen</footer>

  <div id="motoai-backdrop"></div>
  <div id="motoai-root">
    <div id="motoai-bubble" role="button">üë©‚Äçüíª</div>
    <div id="motoai-card" role="dialog" aria-modal="true">
      <div id="motoai-handle"></div>
      <div id="motoai-header">Motoopen AI</div>
      <div id="motoai-body"></div>
      <div id="motoai-input">
        <input id="motoai-input-el" type="text" placeholder="Nh·∫≠p c√¢u h·ªèi..." />
        <button id="motoai-send">G·ª≠i</button>
      </div>
    </div>
  </div>

  <script>
  (function(){
    const SESSION_MSG = 'motoai_v3_msgs';
    const STATE_KEY = 'motoai_v3_open';
    const $ = s => document.querySelector(s);
    const state = { msgs: [] };

    // content index
    function buildCorpus(){
      const txt = document.body.innerText || '';
      const sentences = txt.replace(/\s+/g,' ').split(/(?<=[.?!])\s+(?=[A-Z√Ä-·ª¥0-9"'])/).filter(s=>s.length>20);
      return sentences;
    }
    const CORPUS = buildCorpus();
    function embed(t){ const m=new Map(); const s=t.toLowerCase(); for(let i=0;i<=s.length-3;i++){const g=s.slice(i,i+3);m.set(g,(m.get(g)||0)+1);} return m;}
    function sim(a,b){const ks=new Set([...a.keys(),...b.keys()]);let dot=0,na=0,nb=0;ks.forEach(k=>{const va=a.get(k)||0,vb=b.get(k)||0;dot+=va*vb;na+=va*va;nb+=vb*vb;});return dot/(Math.sqrt(na)*Math.sqrt(nb)+1e-12);}
    function retrieve(q){const qv=embed(q);return CORPUS.map(s=>({text:s,score:sim(qv,embed(s))})).sort((a,b)=>b.score-a.score).slice(0,5);}

    // elements
    const bubble=$('#motoai-bubble'),card=$('#motoai-card'),backdrop=$('#motoai-backdrop');
    const bodyEl=$('#motoai-body'),inputEl=$('#motoai-input-el'),sendBtn=$('#motoai-send'),handle=$('#motoai-handle');

    function loadMsgs(){ try{state.msgs=JSON.parse(sessionStorage.getItem(SESSION_MSG))||[];}catch{state.msgs=[];} }
    function saveMsgs(){ sessionStorage.setItem(SESSION_MSG,JSON.stringify(state.msgs)); }
    function renderMsgs(){
      bodyEl.innerHTML='';
      for(const m of state.msgs){
        const el=document.createElement('div');
        el.className='m-msg '+(m.role==='user'?'user':'bot');
        el.textContent=m.text;
        bodyEl.appendChild(el);
      }
      bodyEl.scrollTop=bodyEl.scrollHeight;
    }

    function greet(){ if(state.msgs.some(m=>m.role==='bot'))return;
      state.msgs.push({role:'bot',text:'Xin ch√†o üëã! M√¨nh l√† Motoopen AI ‚Äî tr·ª£ l√Ω c·ªßa trang. B·∫°n c·∫ßn h·ªèi g√¨ v·ªÅ gi√°, xe hay giao t·∫≠n n∆°i?'});
      saveMsgs();renderMsgs();
    }

    async function ask(q){
      if(!q.trim())return;
      state.msgs.push({role:'user',text:q}); saveMsgs(); renderMsgs();
      inputEl.value=''; sendBtn.disabled=true;

      const typing=document.createElement('div'); typing.className='m-msg bot typing'; typing.textContent='ƒêang nh·∫≠p...'; bodyEl.appendChild(typing);
      bodyEl.scrollTop=bodyEl.scrollHeight;

      await new Promise(r=>setTimeout(r,500+Math.random()*600));
      const res=retrieve(q);
      typing.remove();
      const ans = res.length && res[0].score>0.03 ? res.slice(0,2).map(r=>r.text).join(' ') :
        "M√¨nh ch∆∞a t√¨m th·∫•y th√¥ng tin r√µ r√†ng ü§î. B·∫°n c√≥ th·ªÉ h·ªèi chi ti·∫øt h∆°n ho·∫∑c li√™n h·ªá Zalo 0857 255 868 nh√©!";
      state.msgs.push({role:'bot',text:ans});
      saveMsgs(); renderMsgs(); sendBtn.disabled=false;
    }

    function openCard(){
      card.classList.add('open');backdrop.classList.add('show');bubble.classList.add('hidden');
      localStorage.setItem(STATE_KEY,'1'); greet(); setTimeout(()=>inputEl.focus(),400);
    }
    function closeCard(){
      card.classList.remove('open');backdrop.classList.remove('show');bubble.classList.remove('hidden');
      localStorage.setItem(STATE_KEY,'0'); inputEl.blur();
    }

    sendBtn.onclick=()=>ask(inputEl.value);
    inputEl.onkeydown=e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();ask(inputEl.value);}};

    bubble.onclick=openCard; backdrop.onclick=closeCard;

    // drag dismiss
    let dragStartY=0; let dragging=false;
    handle.addEventListener('touchstart',e=>{dragging=true;dragStartY=e.touches[0].clientY;card.style.transition='none';},{passive:true});
    window.addEventListener('touchmove',e=>{
      if(!dragging)return; const dy=e.touches[0].clientY-dragStartY;
      if(dy>0){card.style.transform=`translateY(${dy}px)`;}},{passive:true});
    window.addEventListener('touchend',e=>{
      if(!dragging)return; dragging=false;card.style.transition='';
      const dy=parseFloat(card.style.transform.replace(/[^0-9.]/g,''))||0;
      if(dy>card.offsetHeight*0.3){closeCard();}else{card.style.transform='translateY(0)';}
    });

    // init
    loadMsgs(); renderMsgs();
    if(localStorage.getItem(STATE_KEY)==='1') openCard();
    window.visualViewport?.addEventListener('resize',()=>{if(card.classList.contains('open'))bodyEl.scrollTop=bodyEl.scrollHeight;});
  })();
  </script>
</body>
</html>
