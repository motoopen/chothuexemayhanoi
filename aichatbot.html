<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Test MotoAI Chat (Dark mode)</title>
<style>
  :root{
    --accent:#007aff;
    --card-bg:rgba(255,255,255,0.96);
    --card-bg-dark:rgba(20,20,22,0.94);
    --text:#111;
  }
  @media(prefers-color-scheme:dark){
    :root{--card-bg:var(--card-bg-dark); --text:#eee;}
    body{background:#071021; color:#ddd;}
  }
  body{font-family:system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial; margin:0; height:100vh;}
  /* wrapper m·∫∑c ƒë·ªãnh kh√¥ng nh·∫≠n pointer-events ƒë·ªÉ tr√°nh ch·∫∑n click ·ªü page */
  #motoai-root{position:fixed; left:18px; bottom:90px; z-index:2147483000; pointer-events:none;}
  #motoai-bubble{pointer-events:auto; width:58px; height:58px; border-radius:14px; display:flex; align-items:center; justify-content:center; font-size:28px; background:var(--accent); color:#fff; box-shadow:0 10px 28px rgba(0,0,0,0.24); cursor:pointer;}
  #motoai-backdrop{position:fixed; inset:0; background:rgba(0,0,0,0.18); backdrop-filter:blur(6px); opacity:0; pointer-events:none; transition:opacity .28s ease; z-index:2147482999;}
  #motoai-backdrop.show{opacity:1; pointer-events:auto;}
  #motoai-card{
    position:fixed; left:0; right:0; bottom:0; height:70vh; max-height:720px; width:min(920px,calc(100% - 28px));
    margin:auto; border-radius:18px 18px 0 0; background:var(--card-bg); box-shadow:0 -12px 40px rgba(10,20,30,0.18);
    transform:translateY(110%); opacity:0; transition:transform .42s cubic-bezier(.2,.9,.2,1), opacity .28s ease; display:flex; flex-direction:column; overflow:hidden; z-index:2147483000;
    pointer-events:auto; /* card c·∫ßn nh·∫≠n s·ª± ki·ªán khi m·ªü */
  }
  #motoai-card.open{transform:translateY(0); opacity:1;}
  #motoai-handle{width:54px; height:6px; background:#d0d6dc; border-radius:6px; margin:10px auto; cursor:grab;}
  #motoai-header{padding:6px 14px; font-weight:700; color:var(--accent); text-align:center;}
  #motoai-body{flex:1; overflow:auto; padding:12px 14px; font-size:15px;}
  .m-msg{margin:8px 0; padding:10px 12px; border-radius:12px; max-width:84%; line-height:1.35; word-wrap:break-word;}
  .m-msg.bot{background:rgba(240,240,246,0.95); color:var(--text);}
  .m-msg.user{background:linear-gradient(180deg,var(--accent),#00b6ff); color:#fff; margin-left:auto;}
  #motoai-input{display:flex; gap:8px; padding:10px; border-top:1px solid rgba(0,0,0,0.06); background:linear-gradient(180deg,rgba(255,255,255,0.6),rgba(255,255,255,0.8));}
  #motoai-input input{flex:1; padding:12px; border-radius:12px; border:1px solid #d6dde6; font-size:16px; background:transparent; color:inherit;}
  #motoai-input button{padding:10px 14px; border-radius:10px; border:none; background:var(--accent); color:#fff; font-weight:700; cursor:pointer;}
  @media(prefers-color-scheme:dark){
    .m-msg.bot{background:rgba(40,40,50,0.9); color:#f2f2f2;}
    #motoai-input{background:rgba(25,25,30,0.9);}
    #motoai-input input{background:rgba(255,255,255,0.08); color:#fff; border:1px solid rgba(255,255,255,0.12);}
    #motoai-input input::placeholder{color:rgba(255,255,255,0.55);}
    #motoai-input input:focus{background:rgba(255,255,255,0.12); border-color:#0a84ff; outline:none;}
  }

  /* nh·ªè g·ªçn: n√∫t chuy·ªÉn theme (ch·ªâ demo) */
  #theme-toggle{position:fixed; left:18px; bottom:18px; z-index:2147483001; background:#222; color:#fff; padding:8px 10px; border-radius:10px; cursor:pointer; font-size:13px; border:none;}
</style>
</head>
<body>

<!-- Th√™m m·ªôt n·ªôi dung demo b√™n d∆∞·ªõi -->
<main style="padding:24px; max-width:900px; margin:auto;">
  <h1>Trang test MotoAI</h1>
  <p>Nh·∫•n bi·ªÉu t∆∞·ª£ng chat ph√≠a d∆∞·ªõi ƒë·ªÉ m·ªü. Th·ª≠ nh·∫≠p ch·ªØ‚Äîkh√¥ng c√≤n b·ªã ƒë√≥ng n·ªØa.</p>
</main>

<!-- Theme toggle (demo) -->
<button id="theme-toggle" aria-pressed="false">Chuy·ªÉn theme</button>

<!-- MotoAI widget -->
<div id="motoai-root" aria-hidden="false">
  <div id="motoai-bubble" role="button" aria-label="M·ªü chat">üë©‚Äçüíª</div>

  <div id="motoai-backdrop" tabindex="-1" aria-hidden="true"></div>

  <div id="motoai-card" role="dialog" aria-modal="true" aria-hidden="true">
    <div id="motoai-handle" title="K√©o ƒë·ªÉ ƒë√≥ng"></div>
    <div id="motoai-header">Motoopen AI</div>
    <div id="motoai-body" aria-live="polite"></div>
    <div id="motoai-input">
      <input id="motoai-input-el" type="text" placeholder="Nh·∫≠p c√¢u h·ªèi..." autocomplete="off" />
      <button id="motoai-send">G·ª≠i</button>
    </div>
  </div>
</div>

<script>
(function(){
  const $ = s => document.querySelector(s);
  const root = $('#motoai-root');
  const bubble = $('#motoai-bubble');
  const card = $('#motoai-card');
  const backdrop = $('#motoai-backdrop');
  const bodyEl = $('#motoai-body');
  const inputEl = $('#motoai-input-el');
  const sendBtn = $('#motoai-send');
  const themeToggle = $('#theme-toggle');

  // tr·∫°ng th√°i messages
  const state = { msgs: [
    { role:'bot', text: 'Ch√†o! Th·ª≠ h·ªèi t√¥i ƒëi·ªÅu g√¨ ƒë√≥ nh√©.' }
  ]};

  function renderMsgs(){
    bodyEl.innerHTML = '';
    state.msgs.forEach(m=>{
      const d = document.createElement('div');
      d.className = 'm-msg ' + (m.role==='user' ? 'user' : 'bot');
      d.textContent = m.text;
      bodyEl.appendChild(d);
    });
    bodyEl.scrollTop = bodyEl.scrollHeight;
  }

  // nh·ªè: corpus simple l·∫•y t·ª´ n·ªôi dung trang
  function buildCorpus(){
    const txt = document.body.innerText || '';
    const withSep = txt.replace(/([.?!])(\s)*(?=[A-Z√Ä-·ª¥0-9"'])/g, '$1|');
    return withSep.split('|').map(s => s.trim()).filter(s => s.length > 20);
  }
  const CORPUS = buildCorpus();
  function dummyRetrieve(q){
    // tr·∫£ ƒëo·∫°n ƒë·∫ßu corpus n·∫øu c√≥ t·ª´ kh√≥a chung, else fallback
    for(const s of CORPUS){
      if(q.split(' ').some(w => s.toLowerCase().includes(w.toLowerCase()))) return s;
    }
    return "Xin l·ªói, m√¨nh ch∆∞a t√¨m th·∫•y th√¥ng tin ƒë√≥ ü§î.";
  }

  // h·ªèi ‚Äî asynchronous gi·∫£ l·∫≠p
  async function ask(q){
    if(!q.trim()) return;
    state.msgs.push({role:'user', text:q});
    renderMsgs();
    inputEl.value = '';
    sendBtn.disabled = true;
    await new Promise(r => setTimeout(r,250));
    const ans = dummyRetrieve(q);
    state.msgs.push({role:'bot', text:ans});
    renderMsgs();
    sendBtn.disabled = false;
    inputEl.focus();
  }

  // M·ªû / ƒê√ìNG: khi m·ªü, b·∫≠t pointer-events cho wrapper ƒë·ªÉ input nh·∫≠n event
  function openCard(){
    card.classList.add('open');
    backdrop.classList.add('show');
    root.style.pointerEvents = 'auto'; // cho ph√©p nh·∫≠n click b√™n trong
    bubble.style.display = 'none';
    card.setAttribute('aria-hidden','false');
    backdrop.setAttribute('aria-hidden','false');
    renderMsgs();
    setTimeout(()=> inputEl.focus(), 250);
  }
  function closeCard(){
    card.classList.remove('open');
    backdrop.classList.remove('show');
    root.style.pointerEvents = 'none'; // v√¥ hi·ªáu khi ƒë√≥ng
    bubble.style.display = 'flex';
    card.setAttribute('aria-hidden','true');
    backdrop.setAttribute('aria-hidden','true');
    bubble.focus();
  }

  // event handlers
  bubble.addEventListener('click', openCard);
  backdrop.addEventListener('click', closeCard);
  sendBtn.addEventListener('click', ()=> ask(inputEl.value));
  inputEl.addEventListener('keydown', e => {
    if(e.key === 'Enter' && !e.shiftKey){
      e.preventDefault();
      ask(inputEl.value);
    }
    // n·∫øu ESC khi ƒëang focus input -> ƒë√≥ng card
    if(e.key === 'Escape'){
      closeCard();
    }
  });
  // ESC to√†n trang c≈©ng ƒë√≥ng n·∫øu ƒëang m·ªü
  document.addEventListener('keydown', e => {
    if(e.key === 'Escape' && card.classList.contains('open')) closeCard();
  });

  // theme toggle demo (thay ƒë·ªïi meta prefers-color)
  let forcedDark = false;
  themeToggle.addEventListener('click', () => {
    forcedDark = !forcedDark;
    if(forcedDark){
      document.documentElement.style.setProperty('--card-bg', getComputedStyle(document.documentElement).getPropertyValue('--card-bg-dark') || '#141417');
      document.body.style.background = '#071021';
      themeToggle.textContent = 'Light mode';
      themeToggle.setAttribute('aria-pressed','true');
    } else {
      document.documentElement.style.removeProperty('--card-bg');
      document.body.style.background = '';
      themeToggle.textContent = 'Chuy·ªÉn theme';
      themeToggle.setAttribute('aria-pressed','false');
    }
  });

  // render init
  renderMsgs();
})();
</script>
</body>
</html>
