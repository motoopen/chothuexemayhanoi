<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Test MotoAI v27</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;padding:24px;line-height:1.6}
    .wrap{max-width:720px;margin:auto}
    .demo{margin:16px 0;display:flex;gap:8px;flex-wrap:wrap}
    button{padding:10px 14px;border-radius:8px;border:1px solid #ddd;background:#fff;cursor:pointer}
    code{background:#f6f8fa;padding:2px 6px;border-radius:6px}
  </style>

  <!-- C·∫•u h√¨nh c·∫ßn ƒë·∫∑t TR∆Ø·ªöC khi n·∫°p script -->
  <script>
    window.MotoAI_CONFIG = {
      brand: "Motoopen",
      phone: "0857255868",
      zalo:  "https://zalo.me/0857255868",
      map:   "https://maps.app.goo.gl/2icTBTxAToyvKTE78",

      autolearn: true,
      extraSites: [
        // n√™n ƒë·ªÉ origin hi·ªán t·∫°i + c√°c site c·ªßa b·∫°n
        location.origin,
        "https://motoopen.github.io/chothuexemayhanoi/",
        "https://thuexemaynguyentu.com",
        "https://rentbikehanoi.com"
      ],
      crawlDepth: 2,          // tƒÉng l√™n 2‚Äì3 n·∫øu mu·ªën qu√©t s√¢u h∆°n
      refreshHours: 24,

      // B·∫≠t c√°c t√≠nh nƒÉng th√¥ng minh (BM25, QA, auto h·ªçc gi√°)
      smart: {
        semanticSearch: true,
        extractiveQA:   true,
        autoPriceLearn: true
      }
    };
  </script>

  <!-- N·∫°p b·∫£n v27 (semantic) t·ª´ link b·∫°n cung c·∫•p -->
  <script src="https://motoopen.github.io/chothuexemayhanoi/motoai_v38_1_debug_semantic_pricing.js" defer></script>
</head>
<body>
  <div class="wrap">
    <h1>Test MotoAI v27 (Semantic + QA + AutoPrice)</h1>
    <p>
      Sau khi trang t·∫£i xong, n√∫t chat s·∫Ω hi·ªán ·ªü g√≥c d∆∞·ªõi ph·∫£i. B·∫°n c√≥ th·ªÉ m·ªü b·∫±ng chu·ªôt ho·∫∑c g·ªçi:
      <code>window.MotoAI_v27.open()</code>.
    </p>

    <div class="demo">
      <button onclick="window.MotoAI_v27 && window.MotoAI_v27.open()">M·ªü chat</button>
      <button onclick="window.MotoAI_v27 && window.MotoAI_v27.close()">ƒê√≥ng chat</button>
      <button onclick="window.MotoAI_v27_autolearn && window.MotoAI_v27_autolearn.learnNow(null, true).then(()=>alert('ƒê√£ h·ªçc l·∫°i (force)'))">
        H·ªçc l·∫°i (force)
      </button>
      <button onclick="window.MotoAI_v27_autolearn && window.MotoAI_v27_autolearn.clearLearnCache(); alert('ƒê√£ xo√° cache h·ªçc');">
        Xo√° cache h·ªçc
      </button>
      <button id="btnStatus">
        üìä Tr·∫°ng th√°i h·ªçc
      </button>
      <button onclick="
        localStorage.removeItem('MotoAI_v26_learn');
        localStorage.removeItem('MotoAI_v26_ctx');
        localStorage.removeItem('MotoAI_v26_session');
        localStorage.removeItem('MotoAI_v26_auto_prices');
        alert('ƒê√£ xo√° to√†n b·ªô cache h·ªçc & phi√™n');
      ">
        üßπ Xo√° to√†n b·ªô cache
      </button>
      <button onclick="console.log(window.MotoAI_v27_autolearn && window.MotoAI_v27_autolearn.getIndex()); alert('ƒê√£ log getIndex() ra console')">
        Log getIndex() ra console
      </button>
    </div>

    <p>
      G·ª£i √Ω test nhanh:
      <ul>
        <li>G√µ <em>‚ÄúB·∫£ng gi√° Vision 2 ng√†y‚Äù</em> ‚Üí SmartCalc ∆∞·ªõc t√≠nh.</li>
        <li>G√µ <em>‚Äúth·ªß t·ª•c‚Äù</em> ho·∫∑c <em>‚Äúƒë·∫∑t c·ªçc‚Äù</em> ‚Üí rule-based + QA tr√≠ch c√¢u c√≥ li√™n quan t·ª´ trang.</li>
        <li>Th·ª≠ <em>‚ÄúAir Blade 1 tu·∫ßn‚Äù</em>, <em>‚Äúxe ƒëi·ªán 3 ng√†y‚Äù</em>‚Ä¶</li>
      </ul>
    </p>
  </div>

  <!-- N√∫t "üîÑ H·ªçc l·∫°i" ch√®n tr·ª±c ti·∫øp v√†o thanh tag trong khung chat -->
  <script>
    (function addLearnTag(retry=60){
      const track = document.getElementById('tagTrack');
      if (!track) { if (retry>0) return setTimeout(()=>addLearnTag(retry-1), 200); return; }

      const btn = document.createElement('button');
      btn.textContent = 'üîÑ H·ªçc l·∫°i';
      btn.title = '√âp h·ªçc l·∫°i ngay (b·ªè qua cache)';
      btn.addEventListener('click', async ()=>{
        const api = window.MotoAI_v27_autolearn || window.MotoAI_v26_autolearn;
        if (!api) return alert('Ch∆∞a c√≥ API h·ªçc (script ch∆∞a n·∫°p?)');
        btn.disabled = true; const old = btn.textContent; btn.textContent = '‚è≥ ƒêang h·ªçc...';
        try {
          await api.learnNow(null, true);
          alert('ƒê√£ h·ªçc l·∫°i xong.');
        } catch(e) {
          alert('Kh√¥ng th·ªÉ h·ªçc l·∫°i: ' + (e && e.message ? e.message : e));
        } finally {
          btn.disabled = false; btn.textContent = old;
        }
      });
      track.appendChild(btn);
    })();
  </script>

  <!-- N√∫t üìä Tr·∫°ng th√°i h·ªçc: th·ªëng k√™ nhanh t·ª´ localStorage -->
  <script>
    (function(){
      const btn = document.getElementById('btnStatus');
      if (!btn) return;
      btn.addEventListener('click', ()=>{
        try{
          const cache = JSON.parse(localStorage.getItem('MotoAI_v26_learn')||'{}');
          const domains = Object.keys(cache);
          const totalPages = domains.reduce((s,d)=> s + ((cache[d]?.pages||[]).length), 0);
          const lastTs = domains.map(d=> cache[d]?.ts||0).sort((a,b)=>b-a)[0] || 0;
          const hours = lastTs ? Math.round(((Date.now()/1000 - lastTs)/3600)*10)/10 : 'N/A';
          alert(`ƒê√£ h·ªçc ${domains.length} domain / ${totalPages} trang.\nL·∫ßn g·∫ßn nh·∫•t: ${hours} gi·ªù tr∆∞·ªõc.`);
        }catch(e){ alert('Kh√¥ng ƒë·ªçc ƒë∆∞·ª£c tr·∫°ng th√°i: '+e); }
      });
    })();
  </script>
</body>
</html>
