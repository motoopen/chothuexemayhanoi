<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>MotoAI Assistant Demo v1.0</title>
  <style>
    body {
      font-family: system-ui, -apple-system, 'Inter', sans-serif;
      background: #f9fafc;
      color: #222;
      margin: 0;
      padding: 40px;
      line-height: 1.6;
    }
    h1 {
      color: #007aff;
      text-align: center;
      font-weight: 800;
      margin-bottom: 10px;
    }
    p.lead {
      text-align: center;
      color: #555;
      font-size: 1.1rem;
      margin-bottom: 30px;
    }
    section {
      max-width: 800px;
      margin: 0 auto 40px;
      background: white;
      padding: 24px;
      border-radius: 10px;
      box-shadow: 0 4px 14px rgba(0,0,0,0.06);
    }
    footer {
      text-align: center;
      margin-top: 60px;
      color: #888;
      font-size: 0.9rem;
    }
  </style>
</head>

<body>
  <h1>üß† MotoAI Assistant v1.0</h1>
  <p class="lead">Chatbot ch·∫°y 100% tr√™n client ‚Äî t·ª± ƒë·ªçc n·ªôi dung trang v√† tr·∫£ l·ªùi c√¢u h·ªèi!</p>

  <section>
    <h2>Gi·ªõi thi·ªáu</h2>
    <p>
      MotoAI Assistant l√† m·ªôt chatbot ho√†n to√†n ch·∫°y ph√≠a client (client-side).  
      N√≥ t·ª± ƒë·ªông c√†o n·ªôi dung trong trang, ph√¢n t√≠ch c√°c th·∫ª <strong>meta</strong>,  
      <strong>JSON-LD/schema</strong> v√† to√†n b·ªô vƒÉn b·∫£n hi·ªÉn th·ªã ƒë·ªÉ t·∫°o ch·ªâ m·ª•c c√¢u (sentence-level index).  
    </p>
    <p>
      Sau ƒë√≥, khi b·∫°n h·ªèi, n√≥ s·∫Ω th·ª±c hi·ªán t√¨m ki·∫øm truy h·ªìi (retrieval)  
      v√† t·∫°o c√¢u tr·∫£ l·ªùi b·∫±ng ph∆∞∆°ng ph√°p t·ªïng h·ª£p tr√≠ch xu·∫•t (extractive synthesis).  
      Kh√¥ng c·∫ßn k·∫øt n·ªëi m√°y ch·ªß ho·∫∑c AI th·∫≠t ‚Äî t·∫•t c·∫£ x·ª≠ l√Ω c·ª•c b·ªô trong tr√¨nh duy·ªát.
    </p>
  </section>

  <section>
    <h2>Demo n·ªôi dung</h2>
    <p>D∆∞·ªõi ƒë√¢y l√† m·ªôt s·ªë th√¥ng tin ƒë·ªÉ MotoAI ƒë·ªçc v√† tr·∫£ l·ªùi th·ª≠ nghi·ªám:</p>
    <ul>
      <li>Xe m√°y Honda Wave l√† d√≤ng xe ph·ªï bi·∫øn, b·ªÅn b·ªâ v√† ti·∫øt ki·ªám nhi√™n li·ªáu.</li>
      <li>Xe Vision ƒë∆∞·ª£c nhi·ªÅu kh√°ch h√†ng ∆∞a chu·ªông nh·ªù thi·∫øt k·∫ø nh·ªè g·ªçn, d·ªÖ ƒëi·ªÅu khi·ªÉn.</li>
      <li>Motoopen cung c·∫•p d·ªãch v·ª• thu√™ xe m√°y gi√° r·∫ª t·∫°i H√† N·ªôi, giao t·∫≠n n∆°i ch·ªâ trong 30 ph√∫t.</li>
      <li>Gi√° thu√™ xe s·ªë ch·ªâ t·ª´ 150k/ng√†y, xe ga t·ª´ 200k/ng√†y.</li>
      <li>Kh√°ch h√†ng c√≥ th·ªÉ thanh to√°n qua ti·ªÅn m·∫∑t ho·∫∑c chuy·ªÉn kho·∫£n.</li>
    </ul>
  </section>

  <footer>
    ¬© 2025 MotoAI Assistant ‚Äî b·∫£n th·ª≠ nghi·ªám ƒë·ªôc l·∫≠p.  
    <br>ƒê·∫∑t file n√†y c·∫°nh website ƒë·ªÉ test giao di·ªán tr∆∞·ªõc khi t√≠ch h·ª£p.
  </footer>

  <!-- === MotoAI Assistant v1.0 (standalone) === -->
  <script>
  (function() {
    const MotoAI = {
      version: "1.0",
      config: {
        aiEndpoint: null,
        maxSnippets: 8,
        maxAnswerLength: 500,
      },
      corpus: [],
      index: [],
      ui: null,
      setServer({ aiEndpoint }) {
        this.config.aiEndpoint = aiEndpoint;
        console.log("[MotoAI] Remote endpoint set:", aiEndpoint);
      },
      init() {
        console.log("%c[MotoAI] Initializing v" + this.version, "color: #4ae;");
        this.extractContent();
        this.buildUI();
      },
      extractContent() {
        const textNodes = [];
        const walker = document.createTreeWalker(document.body, NodeFilter.SHOW_TEXT, null, false);
        while (walker.nextNode()) {
          const txt = walker.currentNode.nodeValue.trim();
          if (txt.length > 30) textNodes.push(txt);
        }

        const metas = Array.from(document.querySelectorAll("meta[name], meta[property]"))
          .map(m => `${m.getAttribute("name") || m.getAttribute("property")}: ${m.getAttribute("content")}`)
          .filter(Boolean);

        const jsonLD = Array.from(document.querySelectorAll('script[type="application/ld+json"]'))
          .map(s => {
            try { return JSON.stringify(JSON.parse(s.textContent), null, 0); }
            catch { return ""; }
          })
          .join("\n");

        const allText = [document.title, ...metas, ...textNodes, jsonLD].join("\n\n");
        const sentences = allText
          .replace(/\s+/g, " ")
          .split(/(?<=[.?!])\s+(?=[A-Z√Ä-·ª¥])/)
          .filter(s => s.length > 20);

        this.corpus = sentences;
        console.log("[MotoAI] Indexed", sentences.length, "sentences.");
      },
      embed(text) {
        const map = new Map();
        const n = 3;
        for (let i = 0; i < text.length - n; i++) {
          const gram = text.slice(i, i + n).toLowerCase();
          map.set(gram, (map.get(gram) || 0) + 1);
        }
        return map;
      },
      similarity(a, b) {
        const keys = new Set([...a.keys(), ...b.keys()]);
        let dot = 0, na = 0, nb = 0;
        for (const k of keys) {
          const va = a.get(k) || 0, vb = b.get(k) || 0;
          dot += va * vb; na += va * va; nb += vb * vb;
        }
        return dot / (Math.sqrt(na) * Math.sqrt(nb) + 1e-9);
      },
      retrieve(query) {
        const qvec = this.embed(query);
        const scores = this.corpus.map(s => ({
          text: s,
          score: this.similarity(qvec, this.embed(s))
        }));
        return scores.sort((a,b) => b.score - a.score).slice(0, this.config.maxSnippets);
      },
      synthesize(query, snippets) {
        const combined = snippets.map(s => s.text).join(" ");
        if (this.config.aiEndpoint) {
          return fetch(this.config.aiEndpoint, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ prompt: query, context: combined })
          })
          .then(r => r.json())
          .then(j => j.answer || JSON.stringify(j))
          .catch(() => this.extractiveFallback(query, combined));
        }
        return Promise.resolve(this.extractiveFallback(query, combined));
      },
      extractiveFallback(query, text) {
        const qWords = query.toLowerCase().split(/\W+/);
        const sentences = text.split(/(?<=[.?!])\s+/);
        const scored = sentences.map(s => {
          const words = s.toLowerCase().split(/\W+/);
          const overlap = qWords.filter(w => words.includes(w)).length;
          return { s, score: overlap / (qWords.length + 1e-9) };
        });
        const best = scored.sort((a,b) => b.score - a.score).slice(0, 3).map(x => x.s).join(" ");
        return best.length > this.config.maxAnswerLength ? best.slice(0, this.config.maxAnswerLength) + "..." : best;
      },
      ask(query) {
        if (!query.trim()) return;
        this.ui.output.innerHTML = "<div class='moto-loading'>ƒêang t√¨m c√¢u tr·∫£ l·ªùi...</div>";
        const snippets = this.retrieve(query);
        this.synthesize(query, snippets).then(ans => {
          this.ui.output.innerHTML = `<div class='moto-answer'>${ans}</div>`;
        });
      },
      buildUI() {
        const box = document.createElement("div");
        box.innerHTML = `
          <style>
            #motoai-box { position: fixed; bottom: 100px; right: 20px; width: 320px; background: #fff;
              border: 1px solid #ccc; border-radius: 8px; box-shadow: 0 2px 12px rgba(0,0,0,.2);
              font-family: system-ui, sans-serif; z-index: 99999; overflow: hidden; }
            #motoai-header { background: #4ae; color: white; padding: 8px 12px; font-weight: bold;
              display: flex; justify-content: space-between; align-items: center; cursor: move; }
            #motoai-content { padding: 10px; max-height: 300px; overflow-y: auto; }
            #motoai-input { display: flex; border-top: 1px solid #ccc; }
            #motoai-input input { flex: 1; border: none; padding: 8px; outline: none; }
            #motoai-input button { background: #4ae; border: none; color: #fff; padding: 8px 12px; cursor: pointer; }
            .moto-answer { white-space: pre-wrap; }
            .moto-loading { color: #888; font-style: italic; }
          </style>
          <div id="motoai-box">
            <div id="motoai-header">MotoAI Assistant <span style="cursor:pointer" id="motoai-close">√ó</span></div>
            <div id="motoai-content"><div class="moto-answer">Xin ch√†o! H·ªèi t√¥i b·∫•t c·ª© ƒëi·ªÅu g√¨ v·ªÅ trang n√†y.</div></div>
            <div id="motoai-input"><input type="text" placeholder="Nh·∫≠p c√¢u h·ªèi..."/><button>H·ªèi</button></div>
          </div>`;
        document.body.appendChild(box);

        const el = box.querySelector("#motoai-box");
        const input = box.querySelector("input");
        const btn = box.querySelector("button");
        const output = box.querySelector("#motoai-content");
        const close = box.querySelector("#motoai-close");

        btn.onclick = () => this.ask(input.value);
        input.onkeydown = e => e.key === "Enter" && this.ask(input.value);
        close.onclick = () => el.remove();

        // Cho ph√©p k√©o h·ªôp chat
        let pos = { top: 0, left: 0, x: 0, y: 0 };
        const header = box.querySelector("#motoai-header");
        header.onmousedown = e => {
          e.preventDefault();
          pos = { x: e.clientX, y: e.clientY, top: el.offsetTop, left: el.offsetLeft };
          document.onmousemove = e2 => {
            const dx = e2.clientX - pos.x, dy = e2.clientY - pos.y;
            el.style.top = pos.top + dy + "px";
            el.style.left = pos.left + dx + "px";
            el.style.bottom = "auto"; el.style.right = "auto";
          };
          document.onmouseup = () => (document.onmousemove = null);
        };

        this.ui = { el, input, btn, output };
      }
    };

    window.MotoAI = MotoAI;
    document.addEventListener("DOMContentLoaded", () => MotoAI.init());
  })();
  </script>
</body>
</html>
