<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
  <title>Chat với MotoAI v31</title>
  <style>
    /* UI chat nhỏ gọn, không đè menu */
    .chat-wrap{position:fixed;right:16px;bottom:16px;z-index:9998;font-family:Inter,system-ui;line-height:1.4}
    .chat-toggle{border:0;border-radius:999px;padding:12px 16px;background:#0a84ff;color:#fff;font-weight:600;cursor:pointer;box-shadow:0 8px 30px rgba(10,132,255,.3)}
    .chat-panel{display:none;position:fixed;right:16px;bottom:74px;width:320px;max-height:60vh;background:rgba(255,255,255,.92);backdrop-filter:blur(10px);border-radius:16px;box-shadow:0 12px 40px rgba(0,0,0,.18);overflow:hidden}
    @media (prefers-color-scheme: dark){ .chat-panel{background:rgba(22,22,24,.85); color:#fff} .chat-input{background:#111;color:#fff;border-color:#222} }
    .chat-head{padding:10px 14px;font-weight:700;display:flex;align-items:center;gap:10px;border-bottom:1px solid rgba(0,0,0,.08)}
    .dot{width:8px;height:8px;border-radius:50%;background:#34c759;box-shadow:0 0 0 3px rgba(52,199,89,.15)}
    .chat-body{padding:12px;height:300px;overflow:auto}
    .msg{margin:6px 0;max-width:85%}
    .me{margin-left:auto;text-align:right}
    .me .bubble{background:#0a84ff;color:#fff}
    .ai .bubble{background:#f2f2f7}
    @media (prefers-color-scheme: dark){ .ai .bubble{background:#1c1c1e;color:#fff} }
    .bubble{display:inline-block;padding:10px 12px;border-radius:14px}
    .chat-foot{display:flex;gap:8px;padding:10px;border-top:1px solid rgba(0,0,0,.08)}
    .chat-input{flex:1;padding:10px;border-radius:12px;border:1px solid #e5e5ea;outline:none}
    .chat-send{padding:10px 14px;border-radius:12px;border:0;background:#0a84ff;color:#fff;font-weight:600;cursor:pointer}
  </style>

  <!-- PHẦN CẤU HÌNH: đổi nhanh phone/map/sitemaps cho từng web -->
  <script>
    window.MotoAI_CONFIG = {
      phone: "0857255868",
      map: "https://maps.app.goo.gl/ABCxyz",
      brand: "Thuê Xe Máy Hà Nội",
      learnSites: [
        "https://motoopen.github.io/chothuexemayhanoi/sitemap.xml",
        "https://thuexemaynguyentu.com/sitemap.xml",
        "https://rentbikehanoi.com/sitemap.xml"
      ],
      learnFallback: [
        "https://motoopen.github.io/chothuexemayhanoi/index.html",
        "https://thuexemaynguyentu.com/",
        "https://rentbikehanoi.com/"
      ],
      maxPagesPerSite: 12
    };
  </script>

  <!-- FILE MOTOAI v31 -->
  <script src="https://motoopen.github.io/chothuexemayhanoi/motoai_v31_smartpolite_multisite.js" defer></script>
</head>
<body>

  <!-- Nút/bảng chat tối giản -->
  <div class="chat-wrap">
    <button class="chat-toggle" id="chatToggle">Chat với MotoAI</button>
    <div class="chat-panel" id="chatPanel" aria-hidden="true">
      <div class="chat-head"><span class="dot"></span> <span id="chatTitle">MotoAI v31</span></div>
      <div class="chat-body" id="chatBody">
        <div class="msg ai"><div class="bubble">Chào bạn, mình có thể hỗ trợ báo giá, thủ tục và giao xe tận nơi bạn nhé.</div></div>
      </div>
      <div class="chat-foot">
        <input id="chatInput" class="chat-input" type="text" placeholder="Nhập câu hỏi… / Ask me anything…" />
        <button id="chatSend" class="chat-send">Gửi</button>
      </div>
    </div>
  </div>

  <script>
    // Mở/đóng chat
    const toggle = document.getElementById('chatToggle');
    const panel  = document.getElementById('chatPanel');
    const bodyEl = document.getElementById('chatBody');
    const input  = document.getElementById('chatInput');
    const send   = document.getElementById('chatSend');
    const title  = document.getElementById('chatTitle');

    // Đổi tiêu đề theo brand
    if (window.MotoAI_CONFIG?.brand) title.textContent = window.MotoAI_CONFIG.brand;

    toggle.addEventListener('click', ()=>{
      const open = panel.style.display === 'block';
      panel.style.display = open ? 'none' : 'block';
      panel.setAttribute('aria-hidden', open ? 'true' : 'false');
      if(!open) setTimeout(()=>input.focus(), 50);
    });

    function appendMsg(text, who='ai'){
      const wrap = document.createElement('div');
      wrap.className = `msg ${who}`;
      const b = document.createElement('div');
      b.className = 'bubble';
      b.textContent = text;
      wrap.appendChild(b);
      bodyEl.appendChild(wrap);
      bodyEl.scrollTop = bodyEl.scrollHeight;
    }

    async function handleSend(){
      const text = input.value.trim();
      if(!text) return;
      appendMsg(text, 'me');
      input.value = '';
      send.disabled = true;

      // gọi AI
      try{
        if(!window.MotoAI || !MotoAI.reply){
          appendMsg("MotoAI chưa sẵn sàng, vui lòng tải lại trang.", 'ai');
        }else{
          const reply = await MotoAI.reply(text);
          appendMsg(reply, 'ai');
        }
      }catch(e){
        appendMsg("Xin lỗi, mình vừa gặp trục trặc nhỏ. Bạn thử lại giúp mình nhé.", 'ai');
        console.warn(e);
      }finally{
        send.disabled = false;
        input.focus();
      }
    }

    send.addEventListener('click', handleSend);
    input.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); handleSend(); }});
  </script>
</body>
</html>
